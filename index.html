<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bachelor Point Season 5</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
--primary:#e63946;
--secondary:#1d3557;
}

body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:#f0f2f5;
padding-bottom:90px;
}

/* TOP BLACK BAR */
.top-black{background:#000;height:28px}

/* HEADER */
.header{
background:linear-gradient(135deg,var(--primary),var(--secondary));
padding:35px 20px 55px;
text-align:center;
color:#fff;
border-radius:0 0 40px 40px;
}

.header h1{
margin:0;
font-size:22px;
font-weight:900;
}

.sub-bar{
margin:12px auto 0;
width:120px;
height:4px;
border-radius:5px;
background:linear-gradient(90deg,#ffd166,#06d6a0);
}

/* FOLDER BAR */
.folder-bar{
display:flex;
gap:12px;
justify-content:center;
margin:-25px 20px 15px;
padding:12px;
background:#fff;
border-radius:18px;
box-shadow:0 8px 20px rgba(0,0,0,.15);
}

.folder-btn{
padding:10px 18px;
border-radius:14px;
border:2px solid var(--primary);
background:transparent;
color:var(--primary);
font-weight:bold;
font-size:13px;
cursor:pointer;
transition:.3s;
}

.folder-btn.active{
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:#fff;
border:none;
}

/* SEARCH */
.search-box{
margin:0 20px 15px;
background:#fff;
border-radius:18px;
padding:15px;
box-shadow:0 8px 20px rgba(0,0,0,.12);
}

.search-box input{
width:100%;
border:none;
outline:none;
font-size:16px;
}

/* CONTENT */
.main-content{
padding:10px 20px;
display:grid;
grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
gap:18px;
}

.card{
background:#fff;
border-radius:22px;
overflow:hidden;
box-shadow:0 8px 18px rgba(0,0,0,.08);
}

.thumb-box{height:165px;background:#ddd}
.thumb-box img{width:100%;height:100%;object-fit:cover}

.card-details{padding:15px;text-align:center}

.unlock-btn{
width:100%;
padding:14px;
border:none;
border-radius:14px;
font-weight:bold;
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:#fff;
}

.locked-btn{background:#555}
.download-btn{background:linear-gradient(135deg,#00c853,#007a33)}

#verify-overlay{
display:none;
position:fixed;
bottom:0;left:0;
width:100%;
height:65px;
background:#fff;
border-top:4px solid #000;
z-index:9999;
align-items:center;
justify-content:center;
gap:15px;
}

#countdown-display{
font-size:30px;
font-weight:900;
background:#eee;
padding:3px 16px;
border-radius:12px;
}
</style>
</head>

<body>

<div class="top-black"></div>

<div id="verify-overlay">
<div id="countdown-display">10</div>
<div style="font-size:13px;font-weight:bold">
‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ö‡¶≤‡¶õ‡ßá...<br>
<span style="font-size:11px;color:#555;font-weight:normal">
‡¶´‡¶ø‡¶∞‡ßá ‡¶è‡¶≤‡ßá ‡¶Ö‡¶ü‡ßã ‡¶ö‡ßá‡¶ï ‡¶π‡¶¨‡ßá
</span>
</div>
</div>

<div class="header">
<h1>Bachelor Point Season 5</h1>
<div class="sub-bar"></div>
</div>

<!-- üìÅ FOLDERS -->
<div class="folder-bar">
<button class="folder-btn active" onclick="setFolder('ALL',this)">üìÅ ALL</button>
<button class="folder-btn" onclick="setFolder('BP S5',this)">üìÅ BP S5</button>
</div>

<div class="search-box">
<input type="text" id="searchInput" placeholder="‡¶è‡¶™‡¶ø‡¶∏‡ßã‡¶° ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." oninput="renderUI()">
</div>

<div class="main-content" id="video-display">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>

<script>
const firebaseConfig={databaseURL:"https://bachelor-point-season-5-default-rtdb.firebaseio.com/"}
firebase.initializeApp(firebaseConfig)
const db=firebase.database()
const tg=window.Telegram.WebApp
tg.expand()

const REQUIRED_SEC=10
const LOCK_TIME=24*60*60*1000
const BOT_USERNAME="Bachelor_Point_Season_5_ep_bot"

let allVideos={}
let currentFolder="ALL"
let countdownTimer=null

db.ref("videos").on("value",snap=>{
allVideos=snap.val()||{}
renderUI()
})

function setFolder(folder,btn){
currentFolder=folder
document.querySelectorAll(".folder-btn").forEach(b=>b.classList.remove("active"))
btn.classList.add("active")
renderUI()
}

function renderUI(){
const box=document.getElementById("video-display")
const search=document.getElementById("searchInput").value.replace(/\D/g,"")
box.innerHTML=""

for(let id in allVideos){
const v=allVideos[id]

if(currentFolder!=="ALL" && v.category!==currentFolder) continue

if(search){
const m=v.name.match(/Episode\s*(\d+)/i)
if(!m || !m[1].includes(search)) continue
}

let step=parseInt(localStorage.getItem("step_"+id))||0
let last=localStorage.getItem("time_"+id)
let locked=last && (Date.now()-last<LOCK_TIME)

let txt="üîí UNLOCK VIDEO",cls="unlock-btn"
if(locked){txt="üö´ ‡¶á‡¶®‡¶¨‡¶ï‡ßç‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®";cls+=" locked-btn"}
else if(step>=v.ads.length){txt="üì• GET DOWNLOAD";cls+=" download-btn"}

box.innerHTML+=`
<div class="card">
<div class="thumb-box"><img src="${v.photo}"></div>
<div class="card-details">
<h4>${v.name}</h4>
<p style="font-size:12px;font-weight:bold">‡¶ß‡¶æ‡¶™: ${step}/${v.ads.length}</p>
<button class="${cls}" onclick="handleAction('${id}')">${txt}</button>
</div>
</div>`
}
}

function handleAction(id){
let last=localStorage.getItem("time_"+id)
if(last && Date.now()-last<LOCK_TIME)return

const ads=allVideos[id].ads
let step=parseInt(localStorage.getItem("step_"+id))||0

if(step>=ads.length){
Swal.fire("‡¶∏‡¶´‡¶≤","‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶á‡¶®‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá","success").then(()=>{
localStorage.setItem("time_"+id,Date.now())
localStorage.setItem("step_"+id,"0")
location.href=`https://t.me/${BOT_USERNAME}?start=${id}`
})
return
}

localStorage.setItem("ad_active","true")
localStorage.setItem("start_time",Date.now())
localStorage.setItem("active_vid",id)
localStorage.setItem("active_step",step)

document.getElementById("verify-overlay").style.display="flex"
document.getElementById("countdown-display").innerText=REQUIRED_SEC

startCountdown()
tg.openLink(ads[step])
}

function startCountdown(){
clearInterval(countdownTimer)
countdownTimer=setInterval(()=>{
if(localStorage.getItem("ad_active")==="true"){
const start=parseInt(localStorage.getItem("start_time"))
const diff=Math.floor((Date.now()-start)/1000)
document.getElementById("countdown-display").innerText=
Math.max(REQUIRED_SEC-diff,0)
}
},1000)
}

function performVerification(){
if(localStorage.getItem("ad_active")!=="true")return

const start=parseInt(localStorage.getItem("start_time"))
const diff=Math.floor((Date.now()-start)/1000)
const remaining=REQUIRED_SEC-diff

clearInterval(countdownTimer)
document.getElementById("verify-overlay").style.display="none"

if(diff>=REQUIRED_SEC){
const vid=localStorage.getItem("active_vid")
const step=parseInt(localStorage.getItem("active_step"))||0
localStorage.setItem("step_"+vid,step+1)
Swal.fire("‚úÖ ‡¶∏‡¶´‡¶≤","‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡ßü‡ßá‡¶õ‡ßá","success")
renderUI()
}else{
Swal.fire("‚ùå ‡¶Ö‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£",
`‡¶Ü‡¶™‡¶®‡¶ø ${diff} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶õ‡¶ø‡¶≤‡ßá‡¶®‡•§
‡¶Ü‡¶∞‡¶ì ${remaining} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`,
"error")
}

localStorage.clear()
}

document.addEventListener("visibilitychange",()=>{
if(document.visibilityState==="visible" &&
localStorage.getItem("ad_active")==="true"){
location.reload()
}
})

window.onload=performVerification
</script>

</body>
</html>